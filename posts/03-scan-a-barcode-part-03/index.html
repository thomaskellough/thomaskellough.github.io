<!DOCTYPE html><html><head><meta charset="UTF-8"/><meta name="og:site_name" content="The Swift Protocol"/><link rel="canonical" href="www.thomaskellough/thomaskellough.github.io"/><meta name="twitter:url" content="www.thomaskellough/thomaskellough.github.io"/><meta name="og:url" content="www.thomaskellough/thomaskellough.github.io"/><title>Swift Skill Building | The Swift Protocol</title><meta name="twitter:title" content="Swift Skill Building | The Swift Protocol"/><meta name="og:title" content="Swift Skill Building | The Swift Protocol"/><meta name="description" content="Swift Skill Building With Thomas Kellough"/><meta name="twitter:description" content="Swift Skill Building With Thomas Kellough"/><meta name="og:description" content="Swift Skill Building With Thomas Kellough"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="http://www.theswiftprotocol.com/images/social.png"/><meta name="og:image" content="http://www.theswiftprotocol.com/images/social.png"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to The Swift Protocol"/></head><body><header><div class="nav-logo"><a href="/"><img src="/Images/blog-logo.png"/></a><nav class="nav-bar"><p>Swift Skill Building With Thomas Kellough</p><ul><li><h3><a href="/home">Home</a></h3></li><li><h3><a href="/posts">Posts</a></h3></li><li><h3><a href="/tags">Tags</a></h3></li></ul></nav></div></header><div class="wrapper"><article><h1>Use AVFoundation to create a scanner to scan your drivers license - Part 3</h1><div class="post-tags" markdown="1">
        <a class="post-category post-category-avfoundation" href="/tags/avfoundation">AVFoundation</a>
        <a class="post-category post-category-torch" href="/tags/torch">Torch</a>
        <a class="post-category post-category-bezierpath" href="/tags/bezierpath">BezierPath</a>
</div><table class="posts-table">
    <tr>
        <th class="th-single-left"><a href="/posts/03-scan-a-barcode-part-02" style="text-decoration: none">&larr; Capturing data</a></th>
    </tr>
</table><h3>Adding a torch</h3><p>Sometimes scanning a license is difficult when there is no light. Well, your phone comes with a light! Apple actually has something called <a href="https://developer.apple.com/documentation/avfoundation/avcapturedevice/1386035-torchmode">torch mode</a> that allows us to easily toggle our light on and off. Let's start by adding a bar button item that we can use to toggle the light. Add this in <code>viewDidLoad</code> of <code>ScannerViewController</code>.</p><pre><code><span class="keyword">let</span> torchButton = <span class="type">UIBarButtonItem</span>(title: <span class="string">"Torch"</span>, style: .<span class="dotAccess">plain</span>, target: <span class="keyword">self</span>, action: <span class="keyword">#selector</span>(toggleTorch))
navigationItem.<span class="property">rightBarButtonItem</span> = torchButton
</code></pre><p>Right now we will get an error, because we have no <code>toggleTorch</code> function. Let's go ahead and add that now. Remember, we need <code>@objc</code> because we are using a selector here. This function will do the following</p><ol><li>Check if the device is capable of video, if not it will perform an early exit</li></ol><ol start="2"><li>Check if the device has a light, if not it will perform an early exit</li></ol><ol start="3"><li>Lock the device for configuration so no other apps can control the light while we are trying to use it here</li></ol><ol start="4"><li>If the light is on turn it off and if it's off turn it on</li></ol><ol start="5"><li>Print an error if something went wrong</li></ol><pre><code><span class="keyword">@objc func</span> toggleTorch() {
    <span class="keyword">guard let</span> device = <span class="type">AVCaptureDevice</span>.<span class="call">default</span>(for: .<span class="dotAccess">video</span>) <span class="keyword">else</span> { <span class="keyword">return</span> }
    <span class="keyword">guard</span> device.<span class="property">hasTorch</span> <span class="keyword">else</span> { <span class="keyword">return</span> }
    
    <span class="keyword">do</span> {
        <span class="keyword">try</span> device.<span class="call">lockForConfiguration</span>()
        
        <span class="keyword">if</span> device.<span class="property">torchMode</span> == .<span class="dotAccess">on</span> {
            device.<span class="property">torchMode</span> = .<span class="dotAccess">off</span>
        } <span class="keyword">else</span> {
            device.<span class="property">torchMode</span> = .<span class="dotAccess">on</span>
        }
        
    } <span class="keyword">catch</span> {
        <span class="call">print</span>(<span class="string">"There was an error trying to use the torch"</span>)
    }
}
</code></pre><p>You should be able to run your app now and see a "Torch" button that you can tap to turn your light on and off. Have fun scanning in the dark!</p><h3>Adding scan bounds</h3><p>There's one more thing I want to show you. You'll notice that when you turn on the scanner you have no idea where to place your barcode. Honestly, if you get it close to the middle you shouldn't have an issue, but we can make it a bit more user friendly if we add some scan bounds to help the user guide the barcode. Let's create a new function to do that for us now. We will do this by using <code>UIBezierPath</code> to draw a rectangle, color it accordingly, and add it to our preview layer. Once again, don't forget to call your function in <code>setUpScanner</code>.</p><pre><code><span class="keyword">func</span> showScanBounds() {
    <span class="keyword">let</span> rectangle = <span class="type">UIBezierPath</span>(rect: <span class="type">CGRect</span>(x: <span class="number">8</span>, y: (view.<span class="property">bounds</span>.<span class="property">size</span>.<span class="property">height</span> / <span class="number">2</span>) + <span class="number">30</span>, width: view.<span class="property">bounds</span>.<span class="property">size</span>.<span class="property">width</span> - <span class="number">16</span>, height: <span class="number">60</span>))
    <span class="keyword">let</span> boundLayer = <span class="type">CAShapeLayer</span>.<span class="keyword">init</span>()
    boundLayer.<span class="property">path</span> = rectangle.<span class="property">cgPath</span>
    boundLayer.<span class="property">fillColor</span> = <span class="type">UIColor</span>(red: <span class="number">0</span>, green: <span class="number">1</span>, blue: <span class="number">0</span>, alpha: <span class="number">0.1</span>).<span class="property">cgColor</span>
    boundLayer.<span class="property">strokeColor</span> = <span class="type">UIColor</span>.<span class="property">green</span>.<span class="property">cgColor</span>
    avPreviewLayer.<span class="call">addSublayer</span>(boundLayer)
}
</code></pre><p>Start up your scanner and you should see something like this!</p><img class="post-image" src="/Images/Posts/03/03-02.png" alt="Scanner with bounds" /><p>I hope this tutorial helped and if you'd like you can see the full source code for this project <a href="https://github.com/thomaskellough/iOS-Tutorials-UIKit-Swift/tree/master/How-To-Scan-A-Barcode">here</a>.</p><table class="posts-table">
    <tr>
        <th class="th-single-left"><a href="/posts/03-scan-a-barcode-part-02" style="text-decoration: none">&larr; Capturing data</a></th>
    </tr>
</table></article></div><div class="footer-social"><div>Â© 2020 The Swift Protocol</div><div>Generated using <a href="https://github.com/johnsundell/publish">Publish</a>. Written in Swift</div><div><a href="https://www.linkedin.com/in/thomas-kellough/">LinkedIn</a> | <a href="https://github.com/thomaskellough">Github</a> | <a href="mailto:theswiftprotocol@gmail.com">Email</a></div></div></body></html>